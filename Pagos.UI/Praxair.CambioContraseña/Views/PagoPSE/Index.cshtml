
@{
    ViewBag.Title = "Pago con PSE";
}
<link rel="stylesheet" href="~/Content/bootstrap.min.css" />
<link href="~/css/font-awesome.min.css" rel="stylesheet" />

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
</head>
<body>
    <div class="row">
        <div class="col-sm-3">
            <label>Monto:</label>
            <span id="TxtMonto">@ViewBag.Monto</span>
        </div>
        <div class="col-sm-3">
            <label>Referencia:</label>
            <span id="TxtReferencia">@ViewBag.Referencia</span>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3">
            <label>Correo electrónico:</label>
        </div>
        <div class="col-sm-3">
            <input type="email" id="TxtMail" maxlength="30" />
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3" style="margin: 2px">
            <label>Entidades:</label>
        </div>
        <div class="col-sm-3" style="margin:5px">
            <select name="CboEntidades" id="CboEntidades" style="margin-right:15px">
                <option value="1" selected>Banco que aprueba</option>
                <option value="2">Banco que declina</option>
                <option value="3">Banco que simula error</option>
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3" style="margin: 2px">
            <label>Tipo cliente:</label>
        </div>
        <div class="col-sm-3" style="margin:5px">
            <select name="CboTipoCliente" id="CboTipoCliente" style="margin-right:15px">
                <option value="1" selected>Persona Natural</option>
                <option value="2">Persona Jurídica</option>
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3" style="margin: 2px">
            <label>Tipo identificación:</label>
        </div>
        <div class="col-sm-3" style="margin:5px">
            <select name="CboTipoIdentificacion" id="CboTipoIdentificacion" style="margin-right:15px">
                <option value="CC" selected>CC</option>
                <option value="NIT">NIT</option>
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-3" style="margin: 2px">
            <label>Numero Identificacion:</label>
        </div>
        <div class="col-sm-3" style="margin:5px">
            <input type="text" id="TxtIdentificacion" maxlength="15" />
        </div>
    </div>



    <div class="row">
        <div class="col-sm-3" style="margin: 2px">
            <label>Observaciones del pago:</label>
        </div>
        <div class="col-sm-3" style="margin:5px">
            <input type="text" id="TxtObservacion" maxlength="64" />
        </div>
    </div>
    <hr />
    <div class="row" style="margin-top:5px; margin-left:5px">
        <div class="col-lg-1">

        </div>
        <div class="col-lg-1">

        </div>
        <div class="col-lg-1">
            <button id="BtnPagoPSE" class="btn btn-lg" style="background-color:blue; color:white"><i class="fa fa-money"> Pagar</i></button>
        </div>
    </div>


    <!--Modal zone-->
    <div class="modal fade" id="DivValidacionPago">
        <div class="modal-dialog" style="width:450px">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" style="font-size: 200%;font-weight:normal;text-align: center;">Pago  </h3>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-10" style="margin:5px">
                            <span id="TxtPreguntaModalPago"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="BtnAceptarValidacionPago" class="btn alert-info" style="background-color: darkslateblue; color: aliceblue" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>

    <!--Modal zone-->

    <div class="modal fade" id="DivValidacionPagoDatos">
        <div class="modal-dialog" style="width:450px">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" style="font-size: 200%;font-weight:normal;text-align: center;">Pago  </h3>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-10" style="margin:5px">
                            <span id="TxtPreguntaModalPagoDatos"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="BtnAceptarValidacionPagoDatos" class="btn alert-info" style="background-color: darkslateblue; color: aliceblue" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>



</body>
</html>


@section scripts{
    <link rel="stylesheet" href="~/Content/bootstrap.min.css" />
    <script src="~/Scripts/jquery-3.4.1.js"></script>
    <script src="~/Scripts/jquery-ui.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>

    <script type="text/javascript">
       //var myVar = '/PagoPSE';
       var myVar = '/IU/PagoPSE';
        
        $(document).ready(function () {

        });

        $('#BtnPagoPSE').on('click', function () {
            $('#BtnPagoPSE').prop('disabled', true);
            var _correo = $('#TxtMail').val();
            var _tipoUsuario = $('#CboTipoCliente').val();
            var _tipoId = $('#CboTipoIdentificacion').val();
            var _identificacion = $('#TxtIdentificacion').val();
            var _banco = $('#CboEntidades').val();
            var _observacion = $('#TxtObservacion').val();
            var _monto = @ViewBag.Monto * 100;
            var _refe = '@ViewBag.Referencia';
            var msg = '';

            if (_identificacion == '') {
                msg += '<p>El número de identificación debe ser diligenciado</p>';
            }

            if (_observacion == '') {
                msg += '<p>La observación debe ser diligenciado' + '</p>';
            }

            if (msg.length > 0) {
                $('#TxtPreguntaModalPagoDatos').html(msg);
                $('#DivValidacionPagoDatos').modal('show');
            }
            else {
                var l = $.post(myVar + '/RealizarPagoPSE', {
                    correo: _correo, tipoUsuario: _tipoUsuario, tipoId: _tipoId, identificacion: _identificacion, banco: _banco,
                    observacion: _observacion, monto: _monto, referencia: _refe
                }, function (data) {
                    if (data) {
                        $('#TxtPreguntaModalPago').html('<p>Pago realizado con éxito<p/>');
                        $('#DivValidacionPago').modal('show');
                    }
                    else {
                        $('#TxtPreguntaModalPago').html('<p>Existe un problema con el pago, por favor intente mas tarde o comuniquese con el administrador<p/>');
                        $('#DivValidacionPago').modal('show');
                    }
                });
            }
        });




        $('#BtnAceptarValidacionPago').on('click', function () {
            location.href = ('../Vacio/Index');
        });


    </script>
}